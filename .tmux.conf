# General
set -g default-command "LANG=ja_JP.UTF-8 ${SHELL}"
set-option -sg escape-time 0
set-option -g history-limit 10000

set-option -g set-titles on
set-option -g set-titles-string "#S - #W"

# Change order of listing the session
bind s choose-tree -sZ -O name

# Prefix
unbind C-b
set-option -g prefix C-j

#================================================================
#     Commands
#================================================================
bind r source-file ~/.tmux.conf \; display "Reloaded!!!"

# prefix + t: clock mode + transient stats
unbind t
bind t clock-mode \; display-message -d 5000 -F "CPU:#($HOME/.tmux/plugins/tmux-cpu/scripts/cpu_percentage.sh) Mem:#($HOME/.tmux/memory_info.sh \"usage\")/#($HOME/.tmux/memory_info.sh) Batt:#($HOME/.tmux/battery_info.sh) %Y/%m/%d %H:%M"

# pane resize by vim key bind
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# copy mode can by use by vim key bind
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# move pane by vim key bind
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# window index start from 1
set-option -g base-index 1
# pane index start from 1
set-option -g base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# color config
set -g default-terminal "${TERM}"
set -ag terminal-overrides ",${TERM}:Tc"

#================================================================
#			any styles
#================================================================
set-option -g pane-active-border-style fg=white
# set-option -g pane-active-border-style bg=white
# set-option -g pane-border-style fg=blue

#================================================================
#			status bar config
#================================================================
# レイアウトは apply-session-color.sh に集約
set-option -g status-position top
set-option -g status-interval 1
set-option -g status-bg colour232
set-option -g status-justify "centre"
set-option -g status-left-length 45
set-option -g status-right-length 70

#================================================================
#			session color hooks
#================================================================
# セッション切り替え・作成・アタッチ時に色を自動適用
set-hook -g after-new-session 'run-shell "~/.tmux/apply-session-color.sh \"#{session_name}\""'
set-hook -g after-new-window 'run-shell "~/.tmux/apply-session-color.sh \"#{session_name}\""'
set-hook -g client-session-changed 'run-shell "~/.tmux/apply-session-color.sh \"#{session_name}\""'
set-hook -g client-attached 'run-shell "~/.tmux/apply-session-color.sh \"#{session_name}\""'

# tpm Plugins
set-option -g @plugin 'tmux-plugins/tpm'
set-option -g @plugin 'tmux-plugins/tmux-cpu'

set-option -g @plugin 'tmux-plugins/tmux-resurrect'
set-option -g @plugin 'tmux-plugins/tmux-continuum'

run -b '~/.tmux/plugins/tpm/tpm'
